version: 0.1

cli:
  version: 1.25.0

plugins:
  sources:
    - id: trunk
      ref: v1.7.1
      uri: https://github.com/trunk-io/plugins

runtimes:
  enabled:
    - go@1.21.0
    - node@22.16.0
    - python@3.12.3

lint:
  ignore:
    - linters: [ALL]
      paths:
        - "**/__pycache__/**"
        - "**/.pytest_cache/**"
        - "**/.mypy_cache/**"
        - "**/.venv/**"
        - "**/node_modules/**"
        - "uv.lock"
        - "*.egg-info/**"
  enabled:
    # Python linters
    - bandit@1.8.6
    - black@25.1.0
    - codespell@2.4.1
    - isort@6.0.1
    - mypy@1.17.1
    - ruff@0.12.7
    
    # General code quality
    - actionlint@1.7.7
    - git-diff-check
    - prettier@3.6.2
    - markdownlint@0.45.0
    - yamllint@1.37.1
    - taplo@0.9.3
    
    # Security & Infrastructure
    - checkov@3.2.461
    - trufflehog@3.90.5
    
    # Shell scripts
    - shellcheck@0.10.0
    - shfmt@3.6.0
    
    # Docker
    - hadolint@2.12.1-beta
    
    # Web technologies (if applicable)
    - eslint@8.57.0
    
    # Rust (if applicable)
    - rustfmt@1.65.0
    
    # Image optimization
    - svgo@4.0.0
    - oxipng@9.1.5
    
  disabled:
    - clippy
    - osv-scanner

actions:
  output_level: verbose
  enabled:
    - trunk-announce
    - trunk-check-pre-push
    - trunk-fmt-pre-commit
    - trunk-upgrade-available
    - pre-commit
    - pre-commit-pre-push
    - pre-commit-commit-msg
    - post-merge-bootstrap
    - bootstrap-now

  definitions:
    - id: pre-commit
      display_name: pre-commit (pre-commit)
      run: |
        bash -lc '
          uv run pre-commit run --hook-stage pre-commit --all-files || \
          uv run python -m pre_commit run --hook-stage pre-commit --all-files
          git add -u
        '
      triggers:
        - git_hooks: [pre-commit]

    - id: pre-commit-pre-push
      display_name: pre-commit (pre-push)
      run: |
        bash -lc '
          uv run pre-commit run --hook-stage pre-push || \
          uv run python -m pre_commit run --hook-stage pre-push
        '
      triggers:
        - git_hooks: [pre-push]

    - id: pre-commit-commit-msg
      display_name: pre-commit (commit-msg)
      run: |
        bash -lc '
          uv run pre-commit run --hook-stage commit-msg --commit-msg-filename "\${1}" || \
          uv run python -m pre_commit run --hook-stage commit-msg --commit-msg-filename "\${1}"
        '
      triggers:
        - git_hooks: [commit-msg]

    - id: post-merge-bootstrap
      display_name: Bootstrap after merge
      run: bash -lc '[ -x tools/bootstrap.sh ] && tools/bootstrap.sh || true'
      triggers:
        - git_hooks: [post-merge]

    - id: bootstrap-now
      display_name: Bootstrap now
      run: bash -lc '[ -x tools/bootstrap.sh ] && tools/bootstrap.sh || echo "No tools/bootstrap.sh found"'